{% extends "base.html" %}

{% block title %}Stages - {{ repo_name }}{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h1>Stages</h1>
    {% if filter_type == 'active' %}
        <a href="{{ url_for('stages.stage_create', repo_name=repo_name, branch='main') }}" class="btn">New Stage</a>
    {% endif %}
</div>

<!-- Tabs for Active vs Committed -->
<div style="border-bottom: 1px solid #30363d; margin-bottom: 24px;">
    <nav style="display: flex; gap: 0;">
        <a href="{{ url_for('stages.stages_list', repo_name=repo_name, filter_type='active') }}"
           style="padding: 10px 16px; color: {% if filter_type == 'active' %}#c9d1d9{% else %}#8b949e{% endif %}; text-decoration: none; {% if filter_type == 'active' %}border-bottom: 2px solid #f78166; margin-bottom: -1px;{% endif %} transition: all 0.2s; display: inline-block;">
            Active
        </a>
        <a href="{{ url_for('stages.stages_list', repo_name=repo_name, filter_type='committed') }}"
           style="padding: 10px 16px; color: {% if filter_type == 'committed' %}#c9d1d9{% else %}#8b949e{% endif %}; text-decoration: none; {% if filter_type == 'committed' %}border-bottom: 2px solid #f78166; margin-bottom: -1px;{% endif %} transition: all 0.2s; display: inline-block;">
            Committed
        </a>
    </nav>
</div>

{% if stages %}
    {% for stage in stages %}
        <div class="card" style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div style="flex: 1; min-width: 0;">
                    <div style="margin-bottom: 8px;">
                        <a href="{{ url_for('stages.stage_detail', repo_name=repo_name, stage_id=stage.id) }}" style="font-weight: 500; font-size: 16px;">
                            {{ stage.name }}
                        </a>
                        {% if stage.committed %}
                            <span style="background-color: #1a4d2e; color: #7ee787; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 8px;">
                                âœ“ Committed
                            </span>
                        {% endif %}
                    </div>
                    {% if stage.description %}
                        <div style="color: #8b949e; font-size: 14px; margin-bottom: 8px;">
                            {{ stage.description }}
                        </div>
                    {% endif %}
                    <div style="display: flex; gap: 16px; color: #8b949e; font-size: 12px;">
                        <span>Based on: <code style="font-size: 11px;">{{ stage.base_ref.replace('refs/heads/', '') }}</code></span>
                        <span>{{ stage.files|length }} file{% if stage.files|length != 1 %}s{% endif %}</span>
                        {% if stage.committed %}
                            <span>
                                Committed {{ stage.committed_at|timeago }}
                                {% if stage.committed_ref %}
                                    to <code style="font-size: 11px;">{{ stage.committed_ref.replace('refs/heads/', '') }}</code>
                                {% endif %}
                                as <a href="{{ url_for('repo.commit_detail', repo_name=repo_name, commit_hash=stage.commit_hash) }}" class="hash">{{ stage.commit_hash[:7] }}</a>
                            </span>
                        {% else %}
                            <span>Created {{ stage.created_at|timeago }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="empty-state">
        {% if filter_type == 'active' %}
            <h3>No active stages</h3>
            <p>Create a stage to start preparing a commit</p>
            <a href="{{ url_for('stages.stage_create', repo_name=repo_name, branch='main') }}" class="btn" style="margin-top: 16px;">Create Stage</a>
        {% else %}
            <h3>No committed stages</h3>
            <p>Stages that have been committed will appear here</p>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
