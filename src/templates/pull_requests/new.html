{% extends "base.html" %}

{% block title %}New Pull Request - {{ repo_name }}{% endblock %}

{% block content %}
<div style="margin-top: 24px;">
    <h1 style="margin-bottom: 24px; font-size: 24px; font-weight: 600;">Open a pull request</h1>

    <form method="POST" action="{{ url_for('pull_requests.create_pull_request_route', repo_name=repo_name) }}">
        <!-- Branch selection -->
        <div style="background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 16px; margin-bottom: 16px;">
            <div style="margin-bottom: 12px; color: #8b949e; font-size: 14px;">
                Choose branches to compare and create a pull request
            </div>

            <div style="display: flex; align-items: center; gap: 12px;">
                <!-- Base branch -->
                <div style="flex: 1;">
                    <label for="base_branch" style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 600;">
                        Base branch
                    </label>
                    <select name="base_branch" id="base_branch"
                            style="width: 100%; padding: 8px 12px; background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 14px;">
                        {% for branch in branches %}
                            <option value="{{ branch.name.replace('refs/heads/', '') }}"
                                    {% if base_branch == branch.name.replace('refs/heads/', '') %}selected{% endif %}>
                                {{ branch.name.replace('refs/heads/', '') }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div style="padding-top: 24px; color: #8b949e;">‚Üê</div>

                <!-- Head branch -->
                <div style="flex: 1;">
                    <label for="head_branch" style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 600;">
                        Compare branch
                    </label>
                    <select name="head_branch" id="head_branch"
                            style="width: 100%; padding: 8px 12px; background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 14px;">
                        {% for branch in branches %}
                            <option value="{{ branch.name.replace('refs/heads/', '') }}"
                                    {% if head_branch == branch.name.replace('refs/heads/', '') %}selected{% endif %}>
                                {{ branch.name.replace('refs/heads/', '') }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>

        <!-- PR Details -->
        <div style="background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; padding: 16px; margin-bottom: 16px;">
            <!-- Title -->
            <div style="margin-bottom: 16px;">
                <label for="title" style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 600;">
                    Title <span style="color: #f85149;">*</span>
                </label>
                <input type="text" name="title" id="title" required
                       placeholder="Add a title for this pull request"
                       style="width: 100%; padding: 8px 12px; background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 14px; box-sizing: border-box;">
            </div>

            <!-- Description -->
            <div style="margin-bottom: 16px;">
                <label for="description" style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 600;">
                    Description
                </label>
                <textarea name="description" id="description" rows="8"
                          placeholder="Add a description (optional)"
                          style="width: 100%; padding: 8px 12px; background-color: #0d1117; border: 1px solid #30363d; border-radius: 6px; color: #c9d1d9; font-size: 14px; font-family: inherit; box-sizing: border-box; resize: vertical;"></textarea>
            </div>

            <!-- Author info (hidden for now, could be made visible later) -->
            <input type="hidden" name="author" value="System User">
            <input type="hidden" name="author_email" value="system@dataworkflow.local">
        </div>

        <!-- Submit buttons -->
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <a href="{{ url_for('pull_requests.pull_requests_list', repo_name=repo_name) }}"
               style="background-color: transparent; color: #c9d1d9; padding: 8px 16px; border: 1px solid #30363d; border-radius: 6px; text-decoration: none; font-weight: 600; display: inline-block;">
                Cancel
            </a>
            <button type="submit"
                    style="background-color: #238636; color: white; padding: 8px 16px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                Create pull request
            </button>
        </div>
    </form>
</div>

<script>
var activeTab = '{{ active_tab|default("pulls") }}';
</script>
{% endblock %}
