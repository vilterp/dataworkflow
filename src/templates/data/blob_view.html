{% extends "base.html" %}
{% from "macros/commit_header.html" import commit_header %}

{% block title %}{{ file_path }} - {{ repo_name }}{% endblock %}

{% block content %}
<!-- Branch and File Path Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <div style="display: flex; gap: 12px; align-items: center;">
        <div style="background-color: #21262d; border: 1px solid #30363d; border-radius: 6px; padding: 5px 12px;">
            <span style="font-weight: 500;">{{ branch }}</span>
        </div>
        <span style="color: #8b949e;">/</span>
        <span style="color: #c9d1d9;">{{ file_path }}</span>
    </div>
    <div style="display: flex; gap: 8px; margin-left: auto;">
        {% if is_python_file %}
            <a href="{{ url_for('workflow_ui.workflow_dispatch', repo_name=repo_name) }}?workflow_file={{ file_path }}&branch={{ branch }}"
               title="Dispatch workflow"
               style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #1f6feb; color: white; border: 1px solid rgba(240,246,252,0.1); border-radius: 6px; text-decoration: none; font-size: 14px;">
                ‚ñ∂
            </a>
        {% endif %}
        <a href="{{ url_for('repo.download_blob', repo_name=repo_name, branch=branch, file_path=file_path) }}"
           title="Download"
           style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #21262d; color: #c9d1d9; border: 1px solid #30363d; border-radius: 6px; text-decoration: none; font-size: 16px;">
            ‚Üì
        </a>
        <a href="{{ url_for('repo.replace_file', repo_name=repo_name, ref=branch, file_path=file_path) }}"
           title="Upload replacement"
           style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #238636; color: white; border: 1px solid rgba(240,246,252,0.1); border-radius: 6px; text-decoration: none; font-size: 16px;">
            ‚Üë
        </a>
        <a href="{{ url_for('repo_edit.edit_blob', repo_name=repo_name, branch=branch, file_path=file_path) }}"
           title="Edit file"
           style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #21262d; color: #c9d1d9; border: 1px solid #30363d; border-radius: 6px; text-decoration: none; font-size: 16px;">
            ‚úèÔ∏è
        </a>
        <form method="POST" action="{{ url_for('repo.delete_file', repo_name=repo_name, ref=branch, file_path=file_path) }}" style="display: inline; margin: 0;">
            <button type="submit"
                    title="Delete file"
                    style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #da3633; color: white; border: 1px solid rgba(240,246,252,0.1); border-radius: 6px; cursor: pointer; font-size: 16px; font-family: inherit; padding: 0;"
                    onclick="return confirm('Are you sure you want to delete {{ file_path }}?');">
                üóëÔ∏è
            </button>
        </form>
    </div>
</div>

{{ commit_header(commit, repo_name, commit_count, branch, file_path, stage_run_count, has_failed, has_running, has_completed) }}

<!-- File Content -->
<div class="card" style="padding: 0; margin-top: 0; border-radius: 0 0 6px 6px;">
    {% if is_binary %}
        <div class="empty-state">
            <h3>Binary file</h3>
            <p>This file contains binary data and cannot be displayed as text.</p>
            <p class="commit-meta">Size: {{ blob.size }} bytes</p>
            <div style="margin-top: 16px;">
                <a href="{{ url_for('repo.download_blob', repo_name=repo_name, branch=branch, file_path=file_path) }}" class="btn">Download File</a>
            </div>
        </div>
    {% elif content %}
        <div style="font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace; font-size: 12px;">
            <table style="width: 100%; border-collapse: collapse; margin: 0;">
                <tbody>
                    {% for line in content.splitlines() %}
                        <tr>
                            <!-- Line number -->
                            <td style="width: 40px; padding: 0 8px; text-align: right; color: #8b949e; user-select: none; border-right: 1px solid #30363d; border-top: none; border-bottom: none; background-color: #0d1117;">
                                {{ loop.index }}
                            </td>
                            <!-- Line content -->
                            <td style="padding: 0 8px; white-space: pre; overflow-x: auto; border: none;">{{ line }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <h3>Empty file</h3>
            <p>This file has no content</p>
        </div>
    {% endif %}
</div>
{% endblock %}
