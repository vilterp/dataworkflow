{% extends "base.html" %}
{% from "macros/commit_header.html" import commit_header %}
{% from "macros/stage_list.html" import stage_list %}
{% from "macros/stage_breadcrumb.html" import stage_breadcrumb %}

{% block title %}{{ workflow_file }} - {{ repo_name }}{% endblock %}

{% block content %}
<!-- Branch and Stage Path Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    {{ stage_breadcrumb(repo_name, branch, workflow_file, stage_path, stage_run_chain) }}
</div>

{{ commit_header(commit, repo_name, commit_count, branch, workflow_file, stage_run_count, has_failed, has_running, has_completed) }}

{% if stage_run %}
<!-- Stage Run Details -->
<div class="card" style="border-radius: 0; border-top: 1px solid #30363d; border-bottom: 0; padding: 12px 16px; margin: 0; background-color: #0d1117;">
    <div style="display: flex; gap: 24px; font-size: 12px;">
        {% if stage_run.started_at %}
        <div>
            <span style="color: #8b949e;">Started:</span>
            <span>{{ stage_run.started_at|timeago }}</span>
        </div>
        {% endif %}
        {% if stage_run.completed_at %}
        <div>
            <span style="color: #8b949e;">Completed:</span>
            <span>{{ stage_run.completed_at|timeago }}</span>
        </div>
        {% endif %}
        {% if stage_run.result_value %}
        <div>
            <span style="color: #8b949e;">Result:</span>
            <code style="background-color: #161b22; padding: 2px 6px; border-radius: 3px;">{{ stage_run.result_value }}</code>
        </div>
        {% endif %}
    </div>
    {% if stage_run.error_message %}
    <div style="margin-top: 8px; padding: 8px; background-color: #161b22; border: 1px solid #f85149; border-radius: 4px;">
        <span style="color: #f85149; font-weight: 500;">Error:</span>
        <pre style="margin: 4px 0 0 0; color: #f85149; font-size: 11px; white-space: pre-wrap;">{{ stage_run.error_message }}</pre>
    </div>
    {% endif %}
</div>
{% endif %}

{{ stage_list(child_stages, stage_files, repo_name, branch, workflow_file, stage_path) }}
{% endblock %}
