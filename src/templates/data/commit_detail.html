{% extends "base.html" %}
{% from "macros/commit_status_icon.html" import commit_status_icon %}
{% from "macros/file_diff_list.html" import file_diff_list %}

{% block title %}Commit {{ commit.hash[:7] }} - DataWorkflow{% endblock %}

{% block content %}
<div class="card">
    <div style="border-bottom: 1px solid #30363d; padding-bottom: 16px; margin-bottom: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
                <h1 style="margin: 0">{{ commit.message.split('\n')[0] }}</h1>
                <div class="commit-meta">
                    {{ commit.author }} &lt;{{ commit.author_email }}&gt; committed {{ commit.committed_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}
                </div>
            </div>
            {{ commit_status_icon(repo_name, commit.hash, stage_run_count, has_failed, has_running, has_completed) }}
        </div>
    </div>

    {% if commit.message.split('\n')|length > 1 %}
        <div style="margin-bottom: 20px; color: #c9d1d9;">
            <pre style="white-space: pre-wrap;">{{ '\n'.join(commit.message.split('\n')[1:]).strip() }}</pre>
        </div>
    {% endif %}

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div>
            <strong>Commit:</strong>
            <code class="hash">{{ commit.hash }}</code>
        </div>
        <div>
            <strong>Parent:</strong>
            {% if commit.parent_hash %}
                <a href="{{ url_for('repo.commit_detail', repo_name=repo_name, commit_hash=commit.parent_hash) }}" class="hash">
                    {{ commit.parent_hash[:7] }}
                </a>
            {% else %}
                <span style="color: #8b949e;">(initial commit)</span>
            {% endif %}
        </div>
        <div>
            <strong>Tree:</strong>
            <a href="{{ url_for('repo.tree_view', repo_name=repo_name, branch=commit.hash) }}" class="hash">{{ commit.tree_hash[:7] }}</a>
        </div>
        {% if branch_names %}
        <div>
            <strong>Branch{{ 'es' if branch_names|length > 1 else '' }}:</strong>
            {% for branch in branch_names %}
                <a href="{{ url_for('repo.tree_view', repo_name=repo_name, branch=branch) }}" style="display: inline-block; margin-right: 8px; padding: 2px 8px; background-color: #1f6feb; color: white; border-radius: 12px; font-size: 12px; text-decoration: none;">
                    {{ branch }}
                </a>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>

<!-- File Changes -->
{{ file_diff_list(file_diffs, repo_name, commit.hash) }}
{% endblock %}
