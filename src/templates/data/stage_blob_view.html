{% extends "base.html" %}
{% from "macros/commit_header.html" import commit_header %}
{% from "macros/stage_breadcrumb.html" import breadcrumb %}
{% from "macros/blob_content.html" import blob_content %}

{% block title %}{{ file_path }} - {{ repo_name }}{% endblock %}

{% block content %}
<!-- Branch and Stage File Path Header -->
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    {{ breadcrumb(repo_name, branch, breadcrumb_path) }}
    <div style="display: flex; gap: 8px; margin-left: auto;">
        <!-- Only show download button for derived data (no edit/replace/delete) -->
        <a href="{{ url_for('workflows_api.download_stage_file', file_id=stage_file.id) }}"
           title="Download"
           style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background-color: #21262d; color: #c9d1d9; border: 1px solid #30363d; border-radius: 6px; text-decoration: none; font-size: 16px;">
            â†“
        </a>
    </div>
</div>

{{ commit_header(commit, repo_name, commit_count, branch, workflow_file, stage_run_count, has_failed, has_running, has_completed) }}

<!-- Stage File Metadata -->
<div class="card" style="border-radius: 0; border-top: 1px solid #30363d; border-bottom: 0; padding: 12px 16px; margin: 0; background-color: #0d1117;">
    <div style="display: flex; gap: 24px; font-size: 12px;">
        <div>
            <span style="color: #8b949e;">Size:</span>
            <span>{{ stage_file.size|filesizeformat }}</span>
        </div>
        <div>
            <span style="color: #8b949e;">Created:</span>
            <span>{{ stage_file.created_at|timeago }}</span>
        </div>
    </div>
</div>

<!-- File Content -->
{{ blob_content(content, is_binary, stage_file.size, url_for('workflows_api.download_stage_file', file_id=stage_file.id)) }}
{% endblock %}
